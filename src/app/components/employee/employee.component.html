<div class="page-container">
  <!-- Notification Component -->
  <div class="notification-container" *ngIf="showNotification">
    <div class="notification" [class]="'notification-' + notificationType">
      <div class="notification-content">
        <span class="notification-icon">
          <i
            *ngIf="notificationType === 'success'"
            class="fas fa-check-circle"
          ></i>
          <i
            *ngIf="notificationType === 'error'"
            class="fas fa-exclamation-circle"
          ></i>
        </span>
        <span class="notification-message">{{ notificationMessage }}</span>
      </div>
      <button class="notification-close" (click)="closeNotification()">
        ×
      </button>
    </div>
  </div>

  <header class="page-header">
    <nav class="breadcrumb">
      <span (click)="goHome()" class="breadcrumb-link">Home</span>
      <span class="breadcrumb-separator">></span>
      <span class="breadcrumb-current">Employee Management</span>
    </nav>
    <h1 class="page-title">Employee Management</h1>
    <p class="page-description">Manage employee information and profiles</p>
  </header>

  <div class="table-container">
    <div class="table-header">
      <h2>Employee Directory</h2>
      <button class="btn btn-primary" (click)="openAddModal()">
        <i class="fas fa-plus"></i> Add Employee
      </button>
    </div>

    <div class="table-wrapper">
      <!-- Loading indicator -->
      <div *ngIf="loading" class="loading-container">
        <div class="loading-spinner"></div>
        <p>Loading employees...</p>
      </div>

      <!-- Error message -->
      <div *ngIf="!loading && error" class="error-container">
        <p class="error-message">{{ error }}</p>
        <button class="btn btn-primary" (click)="loadEmployees()">Retry</button>
      </div>

      <!-- Table content -->
      <table
        class="data-table"
        *ngIf="!loading && !error && employees && employees.length > 0"
      >
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Department</th>
            <th>Designation</th>
            <th class="actions-header">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let employee of employees">
            <td>{{ employee.employee_Id }}</td>
            <td>{{ employee.name }}</td>
            <td>{{ employee.email }}</td>
            <td>{{ employee.department }}</td>
            <td>{{ employee.designation }}</td>
            <td class="actions">
              <button
                class="btn-icon btn-edit"
                (click)="editEmployee(employee)"
                title="Edit"
              >
                <i class="fas fa-edit"></i>
              </button>
              <button
                class="btn-icon btn-delete"
                (click)="deleteEmployee(employee.employee_Id)"
                title="Delete"
              >
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- No data message -->
      <div
        *ngIf="!loading && !error && (!employees || employees.length === 0)"
        class="no-data"
      >
        <p>No employees found.</p>
      </div>
    </div>

    <!-- Pagination Controls -->
    <div
      class="pagination-controls"
      *ngIf="!loading && !error && totalPages > 1"
    >
      <div class="pagination-info">
        <span
          >Showing {{ (currentPage - 1) * pageSize + 1 }} to
          {{ Math.min(currentPage * pageSize, totalItems) }} of
          {{ totalItems }} employees</span
        >
      </div>

      <div class="pagination-navigation">
        <button
          class="btn btn-secondary"
          (click)="goToPage(1)"
          [disabled]="currentPage === 1"
          title="First Page"
        >
          <i class="fas fa-angle-double-left"></i>
        </button>

        <button
          class="btn btn-secondary"
          (click)="prevPage()"
          [disabled]="currentPage === 1"
          title="Previous Page"
        >
          <i class="fas fa-angle-left"></i>
        </button>

        <div class="page-numbers">
          <button
            *ngFor="let page of getPageNumbers()"
            class="btn btn-page"
            [class.active]="page === currentPage"
            (click)="goToPage(page)"
          >
            {{ page }}
          </button>
        </div>

        <button
          class="btn btn-secondary"
          (click)="nextPage()"
          [disabled]="currentPage === totalPages"
          title="Next Page"
        >
          <i class="fas fa-angle-right"></i>
        </button>

        <button
          class="btn btn-secondary"
          (click)="goToPage(totalPages)"
          [disabled]="currentPage === totalPages"
          title="Last Page"
        >
          <i class="fas fa-angle-double-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ isEditing ? "Edit Employee" : "Add Employee" }}</h3>
        <button class="modal-close" (click)="closeModal()">×</button>
      </div>
      <form (ngSubmit)="saveEmployee()" #employeeForm="ngForm">
        <div class="form-group">
          <label for="employee_Id">ID</label>
          <input
            type="number"
            id="employee_Id"
            [(ngModel)]="currentEmployee.employee_Id"
            name="employee_Id"
            required
            class="form-control"
            placeholder="Enter employee ID"
          />
        </div>
        <div class="form-group">
          <label for="name">Name</label>
          <input
            type="text"
            id="name"
            [(ngModel)]="currentEmployee.name"
            name="name"
            required
            minlength="2"
            maxlength="100"
            class="form-control"
            placeholder="Enter employee name"
            #nameRef="ngModel"
          />
          <div
            class="error-message"
            *ngIf="employeeForm.submitted && nameRef.errors?.['required']"
          >
            Name is required
          </div>
          <div
            class="error-message"
            *ngIf="employeeForm.submitted && (nameRef.errors?.['minlength'] || nameRef.errors?.['maxlength'])"
          >
            Name must be between 2 and 100 characters.
          </div>
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <div class="input-wrapper">
            <input
              type="email"
              id="email"
              [(ngModel)]="currentEmployee.email"
              name="email"
              required
              class="form-control"
              [class.invalid]="
                employeeForm.submitted &&
                (employeeForm.form.get('email')?.invalid ||
                  (currentEmployee.email &&
                    !isValidEmail(currentEmployee.email)))
              "
              [class.valid]="
                currentEmployee.email && isValidEmail(currentEmployee.email)
              "
              (blur)="validateEmailField()"
              (input)="onEmailInput()"
              placeholder="Enter valid email address"
            />
            <span class="validation-icon" *ngIf="currentEmployee.email">
              <i
                *ngIf="isValidEmail(currentEmployee.email)"
                class="fas fa-check-circle valid-icon"
              ></i>
              <i
                *ngIf="!isValidEmail(currentEmployee.email)"
                class="fas fa-exclamation-circle invalid-icon"
              ></i>
            </span>
          </div>
          <div
            class="error-message"
            *ngIf="employeeForm.submitted && employeeForm.form.get('email')?.errors?.['required']"
          >
            Email is required
          </div>
          <div
            class="error-message"
            *ngIf="
              employeeForm.submitted &&
              currentEmployee.email &&
              !isValidEmail(currentEmployee.email)
            "
          >
            Invalid email address format.
          </div>
          <div
            class="help-text"
            *ngIf="
              currentEmployee.email && !isValidEmail(currentEmployee.email)
            "
          >
            Email should be in format: example@domain.com
          </div>
        </div>
        <div class="form-group">
          <label for="department">Department</label>
          <input
            type="text"
            id="department"
            [(ngModel)]="currentEmployee.department"
            name="department"
            required
            minlength="2"
            maxlength="50"
            class="form-control"
            placeholder="Enter department"
            #departmentRef="ngModel"
          />
          <div
            class="error-message"
            *ngIf="employeeForm.submitted && departmentRef.errors?.['required']"
          >
            Department is required
          </div>
          <div
            class="error-message"
            *ngIf="employeeForm.submitted && (departmentRef.errors?.['minlength'] || departmentRef.errors?.['maxlength'])"
          >
            Department name must be between 2 and 50 characters.
          </div>
        </div>
        <div class="form-group">
          <label for="designation">Designation</label>
          <input
            type="text"
            id="designation"
            [(ngModel)]="currentEmployee.designation"
            name="designation"
            required
            minlength="2"
            maxlength="50"
            class="form-control"
            placeholder="Enter designation"
            #designationRef="ngModel"
          />
          <div
            class="error-message"
            *ngIf="employeeForm.submitted && designationRef.errors?.['required']"
          >
            Designation is required
          </div>
          <div
            class="error-message"
            *ngIf="employeeForm.submitted && (designationRef.errors?.['minlength'] || designationRef.errors?.['maxlength'])"
          >
            Designation must be between 2 and 50 characters.
          </div>
        </div>
        <div class="modal-actions">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="closeModal()"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="!employeeForm.form.valid"
          >
            {{ isEditing ? "Update" : "Add" }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
